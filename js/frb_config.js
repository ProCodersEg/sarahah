var firebaseConfig={apiKey:"AIzaSyBEtXBiFXnk3jPmb6wdfW4SOvMXJQIjCzg",authDomain:"saraha-5e7fd.firebaseapp.com",databaseURL:"https://saraha-5e7fd-default-rtdb.firebaseio.com/",projectId:"saraha-5e7fd",storageBucket:"saraha-5e7fd.appspot.com",messagingSenderId:"942089850758",appId:"1:942089850758:web:bc767461bc426a904e2607"};const app=firebase.initializeApp(firebaseConfig),firestore=app.firestore(),messaging=app.messaging(),serverKey="AAAA21juT4Y:APA91bEUomQIsA6OcAaQI8lxcstgH4RMVrLyD4vgoU_lTqrO86vrCEJ1sT-f6e8IS0zacaQ8_jYXVCxVLfUiOb8ZA9kvci4NA1kGl1f32Ybx--DCIhFL5itdZl7eWb-iX_nyxHhc3ktP";function getURLParameter(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}var username=getURLParameter("user_id");function getInputVal(e){return document.getElementById(e).value}function submitForm(e){e.preventDefault();var t=getInputVal("name"),n=getInputVal("message");console.log("Name:",t),console.log("Message:",n);var o=document.getElementById("loading-dialog");o&&(o.style.display="block"),setTimeout((function(){saveMessage(t,n)}),100)}function fetchUserIdByUsername(e){return new Promise((function(t,n){firebase.firestore().collection("users").where("username","==",e).limit(1).get().then((function(o){if(o.empty)n(new Error("User not found"));else{var s=o.docs[0].id;console.log("User ID for username",e,"is",s),t(s)}})).catch((function(e){console.error("Error fetching user document:",e),n(e)}))}))}function saveMessage(e,t){fetchUserIdByUsername(username).then((function(n){console.log("User ID is",n);var o=firebase.firestore().collection("users").doc(n).collection("secrets"),s=Date.now(),r={name:e,message:t,timestamp:s};o.add(r).then((function(e){console.log("Message saved successfully with ID: ",e.id);var t=document.getElementById("loading-dialog");t&&(t.style.display="none"),showSuccessToast(),updateCharacterCount(),document.getElementById("contact-form").reset(),sendNotificationToUser(n)})).catch((function(e){console.error("Error saving message:",e)}))})).catch((function(e){console.error("Error:",e.message)}))}function updateCharacterCount(){var e=document.getElementById("message"),t=document.getElementById("char-count"),n=500-e.value.length;t.textContent="Characters remaining: "+n}function showSuccessToast(){var e=document.getElementById("toast-message");e.style.display="block",setTimeout((function(){e.style.display="none"}),2500)}function sendemoji(e){var t=document.getElementById("message"),n=t.selectionStart,o=t.selectionEnd,s=t.value,r=s.substring(0,n)+e+s.substring(o,s.length);t.value=r,t.focus(),t.setSelectionRange(n+e.length,n+e.length)}function sendNotificationToUser(e){firebase.firestore().collection("users").doc(e).get().then((function(e){if(e.exists){var t=e.data().token;if(t){sendNotification({to:t,notification:{title:"New Message",body:"You have a new message from a friend!"}})}else console.error("FCM token not found for user")}else console.error("User document not found in Firestore")})).catch((function(e){console.error("Error fetching user document:",e)}))}function sendNotification(e){const t={method:"POST",headers:{Authorization:`key=${serverKey}`,"Content-Type":"application/json"},body:JSON.stringify(e)};fetch("https://fcm.googleapis.com/fcm/send",t).then((e=>e.json())).then((e=>{console.log("Successfully sent notification:",e)})).catch((e=>{console.error("Error sending notification:",e)}))}document.getElementById("contact-form").addEventListener("submit",submitForm),fetchUserIdByUsername(username).then((function(e){console.log("User ID is",e),firebase.firestore().collection("users").doc(e).get().then((function(e){if(e.exists){var t=e.data().name;t?(document.getElementById("message").placeholder=`Type your message to "${t}" send privately here...`,document.getElementById("userName").textContent=`${t}`):(document.getElementById("message").placeholder="Type your message to this user...",document.getElementById("userName").textContent="Tell your opinion honestly")}else console.error("User document not found in Firestore")})).catch((function(e){console.error("Error fetching user document:",e)}))})).catch((function(e){console.error("Error:",e.message),document.getElementById("message").placeholder="Something went wrong...",document.getElementById("userName").textContent="Tell your opinion honestly";var t=document.querySelector('button[type="submit"]');t&&(t.disabled=!0);var n=document.getElementById("invalid-user-id-toast");n&&(n.style.display="block",setTimeout((function(){n.style.display="none"}),3e3))}));

var firebaseConfig={apiKey:"AIzaSyBEtXBiFXnk3jPmb6wdfW4SOvMXJQIjCzg",authDomain:"saraha-5e7fd.firebaseapp.com",databaseURL:"https://saraha-5e7fd-default-rtdb.firebaseio.com/",projectId:"saraha-5e7fd",storageBucket:"saraha-5e7fd.appspot.com",messagingSenderId:"942089850758",appId:"1:942089850758:web:bc767461bc426a904e2607"};firebase.initializeApp(firebaseConfig);const messaging=firebase.messaging(),serverKey="AAAA21juT4Y:APA91bEUomQIsA6OcAaQI8lxcstgH4RMVrLyD4vgoU_lTqrO86vrCEJ1sT-f6e8IS0zacaQ8_jYXVCxVLfUiOb8ZA9kvci4NA1kGl1f32Ybx--DCIhFL5itdZl7eWb-iX_nyxHhc3ktP";function getURLParameter(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}var userId=getURLParameter("user_id");function fetchUserIdByUsername(e){firebase.database().ref("users").orderByChild("username").equalTo(e).once("value",(function(t){if(t.exists()){var n=Object.keys(t.val())[0];console.log("User ID for username",e,"is",n),firebase.database().ref("users/"+n+"/name").once("value",(function(e){var t=e.val();t?(document.getElementById("message").placeholder=`Type your message to "${t}" send privately here...`,document.getElementById("userName").textContent=`${t}`):(document.getElementById("message").placeholder="Type your message to this user...",document.getElementById("userName").textContent="Tell your openion honsetly")}));var s=firebase.database().ref("allSecrets/"+n+"/secrets");function a(e){return document.getElementById(e).value}document.getElementById("contact-form").addEventListener("submit",(function(e){e.preventDefault();var t=document.getElementById("loading-dialog");t&&(t.style.display="block");var o=a("name"),r=a("message");setTimeout((function(){!function(e,t){var a=s.push(),o=Date.now();a.set({name:e,message:t,sendDate:o},(function(e){if(e)console.error("Error saving message:",e);else{console.log("Message saved successfully");var t=document.getElementById("loading-dialog");t&&(t.style.display="none"),(r=document.getElementById("toast-message")).style.display="block",setTimeout((function(){r.style.display="none"}),2500),s=document.getElementById("message"),a=document.getElementById("char-count"),o=500-s.value.length,a.textContent="Characters remaining: "+o,document.getElementById("contact-form").reset(),sendNotificationToUser(n)}var s,a,o,r}))}(o,r)}),4e3)}))}else{console.error("User with username",e,"not found");var o=document.querySelector('button[type="submit"]');o&&(o.disabled=!0);var r=document.getElementById("invalid-user-id-toast");r&&(r.style.display="block",setTimeout((function(){r.style.display="none"}),3e3))}}))}function sendemoji(e){var t=document.getElementById("message"),n=t.selectionStart,s=t.selectionEnd,a=t.value,o=a.substring(0,n)+e+a.substring(s,a.length);t.value=o,t.focus(),t.setSelectionRange(n+e.length,n+e.length)}function sendNotificationToUser(e){firebase.database().ref("users/"+e+"/token").once("value",(function(e){var t=e.val();if(t){sendNotification({to:t,notification:{title:"New Message",body:"You have a new message from a friend!"}})}else console.error("FCM token not found for user")}))}function sendNotification(e){const t={method:"POST",headers:{Authorization:`key=${serverKey}`,"Content-Type":"application/json"},body:JSON.stringify(e)};fetch("https://fcm.googleapis.com/fcm/send",t).then((e=>e.json())).then((e=>{console.log("Successfully sent notification:",e)})).catch((e=>{console.error("Error sending notification:",e)}))}fetchUserIdByUsername(userId);
